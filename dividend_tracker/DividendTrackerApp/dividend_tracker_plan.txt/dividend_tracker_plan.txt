Dividend Tracker App Project Plan
=================================

Last Updated: August 3, 2025 (End of Day)
Maintainer: Mark
Location: C:\Python_Projects\DividendTrackerApp\

üóÇÔ∏è Overall Directory Structure:
- data/         => Contains CSV/XLSX files exported from Schwab and E*TRADE
  ‚îî‚îÄ‚îÄ history/  => Historical dividend estimates (CSV files by week)
  ‚îî‚îÄ‚îÄ portfolio_history/ => Historical portfolio values (CSV files by week)
- logs/         => Debug and event logs
- modules/      => Python files: parsing, exporting, summaries, API integration
- outputs/      => Final Excel sheets
- dividend_tracker_plan.txt => This planning file
- dt.bat        => Quick run command (just type 'dt' in terminal)
- need to go to command prompt and type "cd /d "C:\Python_Projects\DividendTrackerApp" to be able to use dt in terminal

üéØ Core Goals:
- Track dividends across multiple accounts (Schwab & E*TRADE) ‚úÖ COMPLETE
- Track estimated monthly income with weekly change monitoring ‚úÖ COMPLETE  
- Support manual file uploads or automated API integration ‚úÖ COMPLETE
- Build yearly summary sheets with carryover from prior years ‚úÖ COMPLETE
- Full API integration for real-time data (E*TRADE + Schwab) ‚úÖ COMPLETE
- Portfolio value tracking with historical progression ‚úÖ COMPLETE
- Automated Excel sheet generation with dividend estimates + portfolio values ‚úÖ COMPLETE
- Keep everything Excel-friendly with clean formatting and legible fonts ‚úÖ COMPLETE
- Full documentation for each code module ‚úÖ COMPLETE

üß© Modules Built and Working:
- dividend_loader.py ‚úÖ COMPLETE
  ‚Üí Loads and cleans brokerage Excel files
  ‚Üí Filters dividend rows and standardizes columns

- excel_generator.py ‚úÖ COMPLETE
  ‚Üí Formats and exports DataFrames to Excel
  ‚Üí Applies bold headers, boxed borders, Arial 12 font
  ‚Üí Replaces NaN and 0.0 with blank cells

- build_dividends_sheet.py ‚úÖ COMPLETE
  ‚Üí Orchestrates loading and exporting of E*TRADE files
  ‚Üí Detects IRA vs Taxable accounts from filename
  ‚Üí Creates multi-sheet workbook: Dividends_2025.xlsx

- summary_builder.py ‚úÖ COMPLETE
  ‚Üí Computes monthly and yearly summaries
  ‚Üí Creates "Totals 2025" sheet with comprehensive data

- estimated_income_tracker.py ‚úÖ COMPLETE WITH MAJOR ENHANCEMENTS
  ‚Üí Tracks weekly changes in estimated monthly dividend income
  ‚Üí Integrated portfolio value tracking in same sheet
  ‚Üí Historical data import from Excel (both dividends and portfolio values)
  ‚Üí Color-coded progression tracking (green=increase, red=decrease)
  ‚Üí Creates "Estimated Income 2025" sheet with 33 weeks of data
  ‚Üí Historical portfolio progression with proper week-by-week tracking

- etrade_auth.py ‚úÖ COMPLETE
  ‚Üí OAuth authentication for E*TRADE API
  ‚Üí Automatic token management and refresh

- etrade_account_api.py ‚úÖ COMPLETE
  ‚Üí Real-time position data from E*TRADE API
  ‚Üí Account mapping (IRA vs Taxable)
  ‚Üí Integration with dividend tracking system

- schwab_api_integrated.py ‚úÖ COMPLETE
  ‚Üí Full Schwab API integration using existing Schwab_auth.py
  ‚Üí Real-time portfolio values and position data
  ‚Üí Account differentiation logic (IRA vs Individual using balance)
  ‚Üí Dividend estimates from live position data

- portfolio_config.py ‚úÖ COMPLETE
  ‚Üí Centralized configuration for both E*TRADE and Schwab APIs
  ‚Üí Live portfolio value aggregation across all accounts
  ‚Üí API fallback and error handling

- hybrid_dividend_tracker.py ‚úÖ COMPLETE
  ‚Üí Combines API position validation with Excel dividend estimates
  ‚Üí Cross-reference validation and change detection
  ‚Üí Portfolio change tracking (buys/sells detection)
  ‚Üí Processes estimate files separately from dividend files
  ‚Üí Creates "Estimated Income 2025" sheet
  ‚Üí STATUS: Built but needs column detection debugging

üß© Modules Still To Build:
- reinvestment_tracker.py       # Logs extra investment actions (FUTURE ENHANCEMENT)
- year_carryforward.py          # Migrates year-end values into new year (FUTURE ENHANCEMENT)  
- logger.py                     # Keeps a record of actions and errors (FUTURE ENHANCEMENT)

üìÅ Current Working Files:
DIVIDEND FILES (actual payments):
- etrade_ira_dividends_2025.xlsx
- etrade_taxable_dividends_2025.xlsx

ESTIMATE FILES (projected income):
- etrade_ira_estimates_2025.xlsx ‚úÖ WORKING
- etrade_taxable_estimates_2025.xlsx ‚úÖ WORKING

API INTEGRATION:
- E*TRADE OAuth API ‚úÖ WORKING (Live position data, account balances)
- Schwab API ‚úÖ WORKING (Live portfolio values, position data via existing Schwab_auth.py)

HISTORICAL DATA:
- data/history/ ‚úÖ 32 weeks of dividend estimate tracking
- data/portfolio_history/ ‚úÖ 32 weeks of portfolio value progression
- Historical_Import sheet ‚úÖ Source data for historical tracking

üìÅ Output Workbook:
- Dividends_2025.xlsx ‚úÖ FULLY AUTOMATED
  ‚Ä¢ Sheet: Estimated Income 2025 (INTEGRATED dividend estimates + portfolio values, 33 weeks)
  ‚Ä¢ Sheet: Portfolio Values 2025 (Detailed portfolio tracking)
  ‚Ä¢ Sheet: Retirement Dashboard 2025 (Comprehensive retirement analysis)
  ‚Ä¢ Sheet: Historical_Import (Source data for historical tracking)
  ‚Ä¢ Sheet: E*TRADE IRA Dividends 2025 (Actual dividend payments)
  ‚Ä¢ Sheet: E*TRADE Taxable Dividends 2025 (Actual dividend payments)  
  ‚Ä¢ Sheet: Totals 2025 (Comprehensive summaries)

üèÜ MAJOR ACHIEVEMENTS (July 26, 2025 Session):

‚úÖ SCHWAB DIVIDEND INTEGRATION FIXED
  ‚Ä¢ Fixed Schwab account mapping logic in dividend estimates
  ‚Ä¢ Both Schwab IRA (3 positions) and Schwab Individual (1 position) now appear in dividend tracking
  ‚Ä¢ Used liquidationValue instead of totalMarketValue for account differentiation
  ‚Ä¢ Corrected account mapping to prevent overwriting of data

‚úÖ HISTORICAL PORTFOLIO TRACKING IMPLEMENTED  
  ‚Ä¢ Created import_historical_portfolio_data_from_excel() function
  ‚Ä¢ Imports 32 weeks of historical portfolio data from Historical_Import sheet
  ‚Ä¢ Creates CSV files for each week in data/portfolio_history/
  ‚Ä¢ Portfolio tracking section now shows actual historical progression instead of static values
  ‚Ä¢ Historical data spans Dec 29, 2024 to July 27, 2025

‚úÖ COMPLETE API AUTOMATION
  ‚Ä¢ E*TRADE API: $340,528.97 total ($278,418.62 IRA + $62,110.35 Taxable)
  ‚Ä¢ Schwab API: $51,557.13 total ($49,951.53 IRA + $1,605.60 Individual)  
  ‚Ä¢ Total Portfolio: $514,208.10 (including $122,122 401K manual)
  ‚Ä¢ All dividend estimates include both E*TRADE and Schwab positions

‚úÖ INTEGRATED TRACKING SHEET
  ‚Ä¢ Single "Estimated Income 2025" sheet with both dividend estimates AND portfolio values
  ‚Ä¢ Historical progression showing portfolio growth from $214,491.13 to $514,208.10
  ‚Ä¢ Color-coded changes (green=increase, red=decrease)
  ‚Ä¢ 33 weeks of complete tracking data

‚úÖ DATA VALIDATION & ACCURACY
  ‚Ä¢ User confirmed dividend bottom line matches manual tracking
  ‚Ä¢ Schwab account values correctly differentiated and displayed
  ‚Ä¢ Historical data properly imported and integrated
  ‚Ä¢ All API integrations working with live data

üìÖ Daily Progress Tracker:

üéØ COMPLETED ITEMS (July 25-26, 2025):
  ‚Ä¢ Built and tested dividend_loader.py ‚úÖ
  ‚Ä¢ Built and tested excel_generator.py ‚úÖ  
  ‚Ä¢ Built and tested build_dividends_sheet.py ‚úÖ
  ‚Ä¢ Built and tested summary_builder.py ‚úÖ
  ‚Ä¢ Created dt.bat for easy running (just type 'dt') ‚úÖ
  ‚Ä¢ Built estimated_income_tracker.py ‚úÖ
  ‚Ä¢ Fixed column detection in estimate files ‚úÖ
  ‚Ä¢ Converted CSV estimate files to Excel format ‚úÖ
  ‚Ä¢ Implemented E*TRADE OAuth API integration ‚úÖ
  ‚Ä¢ Implemented Schwab API integration ‚úÖ
  ‚Ä¢ Fixed Schwab account mapping (IRA vs Individual) ‚úÖ
  ‚Ä¢ Added Schwab dividend estimates to tracking ‚úÖ
  ‚Ä¢ Implemented historical portfolio data import ‚úÖ
  ‚Ä¢ Created integrated tracking sheet (dividends + portfolio) ‚úÖ
  ‚Ä¢ Validated all data accuracy with user ‚úÖ

üèÅ CURRENT STATUS (August 3, 2025):
  ‚Ä¢ CORE DIVIDEND TRACKER SYSTEM IS FULLY OPERATIONAL ‚úÖ
  ‚Ä¢ All APIs working with live data ‚úÖ
  ‚Ä¢ Historical tracking implemented ‚úÖ
  ‚Ä¢ User-validated accuracy ‚úÖ
  ‚Ä¢ Complete automation achieved (except 401K manual entry) ‚úÖ
  ‚Ä¢ Colorful GUI popup for 401k value input ‚úÖ
  ‚Ä¢ Fixed E*TRADE live API values (removed hardcoded values) ‚úÖ
  ‚Ä¢ Historical data import from Excel (preserves manual corrections) ‚úÖ
  
  üîß TICKER ANALYSIS WORK IN PROGRESS:
  ‚Ä¢ Started recreating advanced ticker tracking functionality ‚úÖ
  ‚Ä¢ Fixed account separation for duplicate tickers (ABR, AGNC, ECC, QDTE, DX) ‚úÖ
  ‚Ä¢ Account-specific quantities now properly tracked ‚úÖ
  ‚Ä¢ ISSUE: Lost historical data integration during ticker work ‚ùå
  ‚Ä¢ ISSUE: Missing E*TRADE Taxable account data ‚ùå
  ‚Ä¢ ISSUE: Need to integrate with existing dividend yield filtering (4%+) ‚ùå

üìã CURRENT ACTIVE FILES (August 3, 2025):

MAIN DIVIDEND SYSTEM FILES (OPERATIONAL):
- Dividends_2025.xlsx => Main output workbook with all sheets
  ‚Ä¢ "Estimated Income 2025" => Weekly dividend estimates + portfolio values (33 weeks)
  ‚Ä¢ "Portfolio Values 2025" => Detailed portfolio tracking  
  ‚Ä¢ "Retirement Dashboard 2025" => Comprehensive retirement analysis
  ‚Ä¢ "Historical_Import" => Source data for historical tracking
  ‚Ä¢ "E*TRADE IRA Dividends 2025" => Actual dividend payments
  ‚Ä¢ "E*TRADE Taxable Dividends 2025" => Actual dividend payments
  ‚Ä¢ "Totals 2025" => Comprehensive summaries

TICKER ANALYSIS FILES (WORK IN PROGRESS):
- create_historical_ticker_analysis.py => Main ticker analysis script (PARTIALLY WORKING)
  ‚Ä¢ ‚úÖ Fixed account separation for duplicate tickers
  ‚Ä¢ ‚úÖ Proper sorting by account priority  
  ‚Ä¢ ‚ùå Missing historical data integration
  ‚Ä¢ ‚ùå Missing E*TRADE Taxable account data
- create_dividend_filtered_analysis.py => Dividend-focused version with 4% yield filter (PREVIOUS VERSION)
- import_historical_tickers.py => Integrated update system without GUI
- verify_account_separation.py => Testing/verification script
- check_headers.py => Header structure verification

HISTORICAL DATA FILES:
- data/dividend_stocks.xlsx => Historical ticker data with account info
  ‚Ä¢ Contains: Etrade IRA, Schwab IRA, Schwab individual accounts
  ‚Ä¢ Missing: E*TRADE Taxable account positions  
  ‚Ä¢ Structure: Ticker, Account, Qty #, Price Paid $, Payment cycle

API INTEGRATION FILES (OPERATIONAL):
- etrade_account_api.py => E*TRADE API integration ‚úÖ
- schwab_api_integrated.py => Schwab API integration ‚úÖ  
- portfolio_config.py => Centralized API configuration ‚úÖ

üéØ IMMEDIATE NEXT SESSION PRIORITIES:

1. üî¥ CRITICAL: Restore Historical Data Integration
   - The create_historical_ticker_analysis.py lost connection to historical weekly yield data
   - Need to integrate with existing 33 weeks of historical tracking
   - Previous system had weekly yield progression with color coding

2. üî¥ CRITICAL: Add Missing E*TRADE Taxable Account Data  
   - Current ticker analysis only shows: Etrade IRA, Schwab IRA, Schwab individual
   - Missing: E*TRADE Taxable positions (should have ABR, QDTE, etc.)
   - Check data/dividend_stocks.xlsx and add missing account data

3. üü° IMPORTANT: Integrate Dividend Yield Filtering
   - Previous create_dividend_filtered_analysis.py had 4% yield filter
   - Current version processes all tickers without dividend filter
   - Need to combine: account separation + dividend filtering + historical data

4. üü° IMPORTANT: Test Full Integration
   - Verify ticker analysis works with live API data
   - Ensure historical weekly progression is preserved
   - Validate account sorting: E*TRADE IRA ‚Üí E*TRADE Taxable ‚Üí Schwab Individual ‚Üí Schwab IRA

üîß TECHNICAL DEBT TO ADDRESS:

- create_historical_ticker_analysis.py needs historical yield data integration
- Data file missing E*TRADE Taxable positions  
- Account naming inconsistency: "Etrade IRA" vs "E*TRADE IRA"
- Need to merge functionality from create_dividend_filtered_analysis.py
- Ticker Analysis 2025 sheet needs weekly yield column integration

üìä WHAT'S WORKING VS WHAT NEEDS WORK:

‚úÖ WORKING PERFECTLY:
- Core dividend tracking system (estimated_income_tracker.py)
- API integrations (E*TRADE + Schwab)
- Historical dividend and portfolio tracking (33 weeks)
- Account separation logic for duplicate tickers
- Excel formatting and color coding

‚ùå NEEDS COMPLETION:
- Ticker Analysis sheet missing historical yield progression
- E*TRADE Taxable account data not in ticker analysis
- Integration between ticker analysis and existing dividend system
- 4% dividend yield filtering in ticker analysis

üîÆ FUTURE ENHANCEMENT OPPORTUNITIES:
  ‚Ä¢ Add Schwab dividend estimate Excel files for actual dividend income tracking
  ‚Ä¢ Implement reinvestment_tracker.py for transaction logging
  ‚Ä¢ Add 401K API integration if available
  ‚Ä¢ Year-end carryforward functionality
  ‚Ä¢ Additional reporting and analytics features
  ‚Ä¢ Email/notification system for weekly updates

üêõ ISSUES RESOLVED:
  ‚Ä¢ Excel file not saving until correct module was run ‚úÖ FIXED
  ‚Ä¢ FutureWarnings from pandas (replace and concat behavior) ‚úÖ RESOLVED
  ‚Ä¢ Terminal path confusion when running dividend_loader.py alone ‚úÖ FIXED  
  ‚Ä¢ estimated_income_tracker.py column name detection issues ‚úÖ FIXED
  ‚Ä¢ IndentationError in estimated_income_tracker.py ‚úÖ FIXED
  ‚Ä¢ E*TRADE API authentication and token management ‚úÖ FIXED
  ‚Ä¢ Schwab account duplication in portfolio values ‚úÖ FIXED
  ‚Ä¢ Missing Schwab IRA row in dividend estimates ‚úÖ FIXED
  ‚Ä¢ Static portfolio values instead of historical progression ‚úÖ FIXED

üí° KEY TECHNICAL SOLUTIONS IMPLEMENTED:
  ‚Ä¢ OAuth authentication for both E*TRADE and Schwab APIs
  ‚Ä¢ Account differentiation using balance-based logic for Schwab MARGIN accounts
  ‚Ä¢ Historical data import from Excel with formula evaluation and date calculation
  ‚Ä¢ Integrated sheet design combining dividend estimates and portfolio tracking
  ‚Ä¢ Live API data with fallbacks for reliability
  ‚Ä¢ Portfolio value calculation from position data (bypassing broken balance APIs)
  ‚Ä¢ Historical CSV storage system for week-by-week progression tracking


My expectation for the dividend tracker app.
1.	Upon running the app on the weekend, it should ask for the current 401K  value update the Portfolio_2025 sheet with current real-time data from all four accounts in both Schwab and E*Trade.
2.	Update the Estimated Income 2025 page with separate listings for each of the 4 accounts and total on the bottom of the 4 accounts.
3.	Update the Ticker Analysis 2025 sheet by inserting a new column just right of the original yield column, color coded red for decrease from original yield and green for increase from original yield with yellow for same as original, calculate average dividend below all account dividend entries. 
4.	Update the Ticker Analysis 2025 sheet with Current ticker value and calculate total value at the bottom as well as calculating Total gain from original value. Color code  the difference from original value to current value, red for decrease and green for increase.
5.	Update the Ticker Analysis 2025 sheet with any new tickers added or removed as well ss qty of each ticker in each account. 
6.	Once all data has been updated and calculations completed display the popup gui to show summary of dividends with estimated monthly dividend by account and totally.
7.	Display in column 2 of the gui the Portfolio values with changes from last week to this by account (all 4 accounts) then a total of all 4 accounts.


üß† Ground Rules:
- Everything gets coded 1 step at a time ‚úÖ
- Clear placement and full code replacements for updates or bug fixes ‚úÖ
- Well-documented code with labeled sections and functions ‚úÖ
- No partial code fixes or vague comments like "existing code..." ‚úÖ
- No NaN, NaN strings, or 0.0 values‚Äîuse blank fields instead ‚úÖ
- Headers are bold, boxed cells, totals clearly identified ‚úÖ
- Font size must be legible (Arial 12 preferred) ‚úÖ
- Minimize character count in code to avoid Copilot truncation ‚úÖ
- Use a dedicated workspace so all files/modules pertain to this app ‚úÖ
- Provisions for foggy days and rabbit hole avoidance ‚úÖ
- Maintain a bullet-point file that updates daily to avoid re-explaining everything ‚úÖ
- All gui's and popups should be colorful 

üéâ SYSTEM STATUS: PRODUCTION READY

üîÑ What Copilot Needs to Know for Next Session:

üéØ MAIN DIVIDEND SYSTEM STATUS: ‚úÖ FULLY OPERATIONAL
- Core dividend tracker working perfectly with 33 weeks of historical data
- API integrations (E*TRADE + Schwab) providing live data
- "Estimated Income 2025" sheet with dividend estimates + portfolio values
- Total portfolio value: $514,208.10 across all accounts
- All existing functionality preserved and working

üîß TICKER ANALYSIS STATUS: üîÑ PARTIAL - NEEDS COMPLETION
- Fixed account separation: duplicate tickers now show separately per account
- Account sorting working: Etrade IRA ‚Üí Schwab individual ‚Üí Schwab IRA  
- PROBLEM: Lost historical yield progression during account separation work
- PROBLEM: Missing E*TRADE Taxable account in ticker analysis
- PROBLEM: No integration with 4% dividend yield filter

üìã CRITICAL MISSING PIECES:
1. Historical weekly yield data integration (was working in previous versions)
2. E*TRADE Taxable account positions missing from data/dividend_stocks.xlsx
3. Weekly yield columns with color coding (green/red/yellow progression)
4. Integration between ticker analysis and existing dividend system
5. 4% dividend yield filter to separate dividend stocks from growth stocks

üíæ KEY FILES THAT WORK VS NEED FIXING:
- ‚úÖ estimated_income_tracker.py => PERFECT (main dividend system)
- ‚úÖ Dividends_2025.xlsx => PERFECT (main workbook with 33 weeks data)
- üîÑ create_historical_ticker_analysis.py => PARTIAL (account separation works, missing historical data)
- üîÑ data/dividend_stocks.xlsx => PARTIAL (missing E*TRADE Taxable account)
- ‚ùå Ticker Analysis 2025 sheet => INCOMPLETE (no weekly yield progression)

üéØ NEXT SESSION GOAL:
Complete the ticker analysis system by restoring historical data integration and adding missing account data, while preserving the account separation fix that was successfully implemented today.

üöÄ CURRENT SYSTEM STATUS:

‚úÖ CORE DIVIDEND SYSTEM: PRODUCTION READY
- Weekly updates: Run estimated_income_tracker.py with API integration
- Historical imports: 33 weeks of dividend and portfolio progression data
- All systems automated except 401K (manual entry via colorful GUI)
- Full API automation eliminates manual file processing
- Main dividend tracking system fully operational and user-validated

üîÑ TICKER ANALYSIS SYSTEM: PARTIALLY COMPLETE
- Account separation mechanism working (fixed duplicate ticker issue)
- Missing historical yield progression integration  
- Missing E*TRADE Taxable account data
- Needs integration with dividend yield filtering (4%+ filter)

üéØ NEXT SESSION TASKS:
1. Restore historical weekly yield data to Ticker Analysis 2025 sheet
2. Add E*TRADE Taxable account positions to data/dividend_stocks.xlsx
3. Integrate 4% dividend yield filter into ticker analysis
4. Test full system integration between dividend tracker and ticker analysis
5. Validate complete account coverage: E*TRADE IRA + E*TRADE Taxable + Schwab Individual + Schwab IRA

üéØ OPTIONAL FUTURE ENHANCEMENTS:
- Schwab dividend estimate files for actual dividend income tracking
- 401K API integration (if available)
- Additional analytics and reporting features
- Transaction logging and reinvestment tracking
- Automated notifications and alerts

PROJECT STATUS: 
‚úÖ CORE DIVIDEND TRACKER: COMPLETE AND OPERATIONAL
üîÑ TICKER ANALYSIS SYSTEM: PARTIAL - NEEDS HISTORICAL DATA RESTORATION

üìù AUGUST 3, 2025 SESSION SUMMARY:
- ‚úÖ Successfully fixed account separation for duplicate tickers (ABR, AGNC, ECC, QDTE, DX)
- ‚úÖ Each ticker now appears separately per account with correct quantities
- ‚úÖ Account sorting mechanism implemented and working
- ‚ùå Lost historical weekly yield progression during account separation work
- ‚ùå E*TRADE Taxable account missing from ticker analysis  
- ‚ùå Need to restore integration with existing 33 weeks of historical data
- ‚ùå Need to integrate 4% dividend yield filter from previous version

üîß TECHNICAL NOTES FOR NEXT SESSION:
- create_historical_ticker_analysis.py has working account separation but needs historical data integration
- create_dividend_filtered_analysis.py had working dividend filter and historical data but lacks account separation
- Need to merge the best of both approaches: account separation + historical data + dividend filtering
- Existing dividend system (estimated_income_tracker.py) remains fully operational and should not be modified